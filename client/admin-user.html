<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>積分管家</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
  <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
  <link rel="stylesheet" type="text/css" href="../client/assets/css/useredit.css">
  <link rel="stylesheet" type="text/css" href="../client/assets/css/all.css">
</head>

<body>
  <div id="header"></div>
  <div class="container">
    <div class="row">
      <div class="col-6">
        <div class="h4 userTitle">
          <span class="userTitleSpan">個人資料</span>
        </div>
      </div>
      <div class="edit col-6"><button class="asd" onclick="editMember()">編輯資料</button></div>
    </div>

    <form action="">
      <div class="row">
        <div class="col-6">
          <div class="mb-3">
            <label class="form-label">帳號：</label>
            <input type="text" readonly="readonly" id="Accountback" class="MM FControl">
          </div>
          <script>
            const backacc = sessionStorage.getItem('Accountback');
          
            document.getElementById('Accountback').value = backacc;
        
          </script>
          <div class="mb-3">
            <label class="form-label">密碼：</label>
            <input type="password" readonly="readonly" id="mempassword" class="MM FControl">
          </div>
          <div class="mb-3">
            <label class="form-label">姓名：</label>
            <input type="text" readonly="readonly" id="memname" class="MM FControl">
          </div>

        </div>
        <div class="col-6">

          <div class="mb-3">
            <label class="form-label">聯絡電話：</label>
            <input type="tel" readonly="readonly" id="memphone" maxlength="10" class="MM FControl">
          </div>
          <div class="mb-3">
            <label class="form-label">電子信箱：</label>
            <input type="email" readonly="readonly" id="mememail" class="MM FControl">
          </div>
        </div>
      </div>


      <div class="submitButton"><input type="submit" value="儲存" id="sureBtn"></div>
    </form>
  </div>
  <div id="footer"></div>
  <script>
    $(function () {
      $("#header").load("back.html")
      $("#footer").load("footer.html")
    });



    // 編輯個人資料
    function editMember() {
      $('.MM').css({
        'border-width': '1px',
        'padding': '0.375rem 2.25rem 0.375rem 0.75rem',
        'border-radius': '0.375rem',
      });
      $('.FControl').css({
        'border-color': '#ced4da'
      });

      $('.M-password').css({
        'display': 'flex'
      })
      $('.submitButton').css({
        'display': 'flex'
      })
      $('.asd').css({
        'display': 'none'
      })
      $('#Accountback').removeAttr("readonly");
      $('#mempassword').removeAttr("readonly");
      $('#mememail').removeAttr("readonly");
      $('#memid').removeAttr("readonly");
      $('#memphone').removeAttr("readonly");
      $('#selectwho').removeAttr("disabled");
      $('#startdate').removeAttr("disabled");
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.5/dist/umd/popper.min.js"
    integrity="sha384-Xe+8cL9oJa6tN/veChSP7q+mnSPaj5Bcu9mPX5F5xIGE0DVittaqT5lorf0EI7Vk" crossorigin="anonymous">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.min.js"
    integrity="sha384-kjU+l4N0Yf4ZOJErLsIcvOU2qSb74wXpOhqTvwVx3OElZRweTnQ6d31fXEoRD1Jy" crossorigin="anonymous">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous">
  </script>

  <!--firebase-->
<script type="module">
  // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
const firebaseConfig = {
apiKey: "AIzaSyBxyo9c07rd1CzGXbEnu9jmutXAbIBiHis",
authDomain: "contactform-d7d05.firebaseapp.com",
databaseURL: "https://contactform-d7d05-default-rtdb.firebaseio.com",
projectId: "contactform-d7d05",
storageBucket: "contactform-d7d05.appspot.com",
messagingSenderId: "371807550240",
appId: "1:371807550240:web:5a7fb2cd0674cd8f4bb545"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);

import{
getFirestore, doc, setDoc, collection, addDoc, getDoc,updateDoc,deleteDoc
}
from "firebase/firestore";

const db = getFirestore();

//抓ID值
let pass = document.getElementById("mempassword");
let name = document.getElementById("memname");
let job = document.getElementById("selectwho");
let idnum = document.getElementById("memid");
let tele = document.getElementById("memphone");
let email = document.getElementById("mememail");
let start = document.getElementById("startdate");
let end = document.getElementById("changeDate");

let sure = document.getElementById("sureBtn");

//get剩下的值
async function get(){
        var ref = doc(db,"後台人員資料", backacc);
        const docSnap = await getDoc(ref);

        if(docSnap.exists()){
            name.value = docSnap.data().後台人員姓名;
            email.value = docSnap.data().電子郵件;
            tele.value = docSnap.data().電話;
            pass.value = docSnap.data().密碼;
        }
        else{
            alert("No such Document");
        }
      }

      window.onload = get;



    //update data
    async function update(){
            var ref = doc(db,"後台人員資料", backacc);

            await updateDoc(
                ref,{
                    後台人員姓名 : name.value,
                    電話 : tele.value,
                    密碼 : pass.value,
                    電子郵件 : email.value              
                    }
            )
            .then(()=>{
            alert("資料更新成功!!");
            window.location.reload();
            })
            .catch((error)=>{
                alert("Unsuccessful operation, error"+error);
            });
          
        }
        
        sure.addEventListener("click",(e) =>{
        e.preventDefault();
        update();
      });


</script>
</body>

</html>