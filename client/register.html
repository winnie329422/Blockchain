<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>積分管家</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
  <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
  <link rel="stylesheet" type="text/css" href="assets/css/register.css">
  <link rel="stylesheet" type="text/css" href="assets/css/all.css">
</head>

<body>
  <div id="header"></div>

    <div class="container">
        <span class="h4 userTitleSpan">長照人員註冊
        </span>
        <div class="mb-3" style="margin-top: 30px;">
          <label class="form-label">姓名</label>
          <input type="text" class="form-control" placeholder="林小美"  id="name" required>
        </div>
        <div class="mb-3">
          <label class="form-label">職類(項)名稱</label>
          <select class="form-select" aria-label="Default select example" id="job" required>
            <option value="">請選擇</option>
            <option value="照顧服務員" >照顧服務員</option>
            <option value="社工師" >社工師</option>
            <option value="護理師" >護理師</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">身分證字號/護照號碼</label>
          <input type="text" class="form-control" placeholder="例如：A123456789" id="idnum" required>
        </div>
        <div class="mb-3">
          <label class="form-label">聯絡電話</label>
          <input type="tel" maxlength="10" class="form-control" placeholder="例如：0912345678" id="tele" required>
        </div>
        <div class="mb-3">
          <label class="form-label">電子信箱</label>
          <input type="email" class="form-control" placeholder="例如：example@gmail.com" id="email" required>
        </div>
        <!-- <div class="mb-3">
          <label class="form-label">證照生效日期</label>
          <input type="date" id="startdate" onchange="startdateFunction()" class=" form-control"  required>
        </div>
        <div class="mb-3">
          <label class="form-label">證照失效日期</label>
          <input type="text" id="changeDate" disabled class="form-control" placeholder="失效日期" required>
        </div> -->
        <div class="mb-3">
          <label class="form-label">區塊鏈帳戶</label>
          <input type="text" class="form-control" placeholder="請輸入區塊鏈帳號" id="block" required>
        </div>
        <div class="mb-3">
          <label class="form-label">帳號(未來在此網站上登入的帳號名稱)</label>
          <input type="text" class="form-control" placeholder="請輸入帳號" id="acc" required>
        </div>
        <div class="mb-3">
          <label class="form-label">密碼</label>
          <input type="password" class="form-control" placeholder="請輸入密碼" id="pass" required>
        </div>
        <div class="submitButton"><input type="submit" value="註冊" id="Insbtn"></div>
    </div>
  
  <div id="footer"></div>
  <script>
    $(function () {
      $("#header").load("indexh.html")
      $("#footer").load("footer.html")
    });

    function startdateFunction() {
      // var startdate = new Date(document.getElementById("startdate").value)
      // var year = startdate.getFullYear();
      // var month = startdate.getMonth();
      // var day = startdate.getDate();
      // var c = new Date(year + 1, month, day);
      var chooseDate = new Date(document.getElementById("startdate").value)
      y = chooseDate.getFullYear() + 6
      // chooseDate.setDate(chooseDate.getFullYear() + 7);
      var futureDate =
        y + '-' + ('0' + (chooseDate.getMonth() + 1)).slice(-2) + '-' + ('0' + (chooseDate
          .getDate())).slice(-2);
      // alert('7 days later will be ' + futureDate);
      document.getElementById("changeDate").value = futureDate
    }
    // const input = document.querySelector('#startdate')
    // input.onchange = (e) => {
    // console.log(e.target.value)
    // }
  </script>


<!--Firebase-->
<script type="module">
  // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
const firebaseConfig = {
apiKey: "AIzaSyBxyo9c07rd1CzGXbEnu9jmutXAbIBiHis",
authDomain: "contactform-d7d05.firebaseapp.com",
databaseURL: "https://contactform-d7d05-default-rtdb.firebaseio.com",
projectId: "contactform-d7d05",
storageBucket: "contactform-d7d05.appspot.com",
messagingSenderId: "371807550240",
appId: "1:371807550240:web:5a7fb2cd0674cd8f4bb545"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);

import{
getFirestore, doc, getDoc, setDoc, collection, addDoc, updateDoc, deleteDoc, deleteField
}
from "firebase/firestore";

const db = getFirestore();

// Reference

let Name = document.getElementById("name");
let Job = document.getElementById("job");
let Id = document.getElementById("idnum");
let Tele = document.getElementById("tele");
let Email = document.getElementById("email");
let Stardate = document.getElementById("startdate");
let ChangeDate = document.getElementById("changeDate");
let Account = document.getElementById("acc");
let Password = document.getElementById("pass");
let block = document.getElementById("block");

//button
let set = document.getElementById("Insbtn");

//Adding document
//insert function

//辨認是否已被註冊過
async function get(){
        var ref = doc(db,"長照人員資料", Account.value);
        const docSnap = await getDoc(ref);

        if(docSnap.exists()){
            alert("帳號已被註冊過");
        }
        else{
          AddDocument_CustomID();
        }
      }

//註冊資料
async function AddDocument_CustomID(){
var ref = doc(db, "長照人員資料",Account.value);
const docRef = await setDoc(
ref, {
  姓名: Name.value,
  職類: Job.value,
  身分證或護照號碼: Id.value,
  聯絡電話: Tele.value,
  電子信箱: Email.value,
  證照生效日期: Stardate.value,
  證照失效日期: ChangeDate.value,
  區塊鏈帳戶: block.value,
  帳號: Account.value,
  密碼: Password.value
}
)
.then(()=>{
  alert("註冊成功!!");
  window.location.reload();
})
.catch((error)=>{
alert("註冊失敗"+ error);
});
};

set.addEventListener("click",(e) =>{
    e.preventDefault();
    get();
  });


</script>

  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.5/dist/umd/popper.min.js"
    integrity="sha384-Xe+8cL9oJa6tN/veChSP7q+mnSPaj5Bcu9mPX5F5xIGE0DVittaqT5lorf0EI7Vk" crossorigin="anonymous">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.min.js"
    integrity="sha384-kjU+l4N0Yf4ZOJErLsIcvOU2qSb74wXpOhqTvwVx3OElZRweTnQ6d31fXEoRD1Jy" crossorigin="anonymous">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous">
  </script>
</body>

</html>